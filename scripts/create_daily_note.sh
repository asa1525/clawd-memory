#!/bin/bash
# Obsidian Daily Note Creator (Append or Create version)
# Runs daily at 8:30 AM

# Configuration
NOTE_DIR="$HOME/.openclaw/workspace/storage/vault/u_1/note"
MEMORY_FILE="/root/.openclaw/workspace/MEMORY.md"
TODAY=$(date +%Y-%m-%d)

# Extract todos from MEMORY.md
get_todos() {
    echo "## ðŸ“‹ å¾…åŠžäº‹é¡¹"
    echo ""
    echo "### ðŸ”„ æŒç»­è¿›è¡Œ"
    if [ -f "$MEMORY_FILE" ]; then
        grep -A 30 "å¾…åŠžè¿½è¸ª" "$MEMORY_FILE" 2>/dev/null | grep "^- " | sed 's/^- /- [ ] /' | head -10
    fi
    echo ""
    echo "### ðŸ’¼ å·¥ä½œä»»åŠ¡"
    echo "- [ ] ä¸Ž Chapin è·Ÿè¿›æ•°æ®ä¸­å°é¡¹ç›®è¿›å±•"
    echo "- [ ] è”ç³»æ·±åœ³ office çœ‹æˆ¿éœ€æ±‚åé¦ˆ"
    echo "- [ ] è·Ÿè¿› SAP æŽ¥å£å¼€å‘éœ€æ±‚ç¡®è®¤"
    echo "- [ ] ç”¨å‹äº‘ç«¯é¡¹ç›®è¿›åº¦è·Ÿè¿›"
    echo "- [ ] GP% Dashboard å¼€å‘ï¼ˆç­‰å¾… Ken æä¾›åŽ†å²æ•°æ®ï¼‰"
    echo "- [ ] AR Dashboard å¼€å‘ï¼ˆç­‰å¾…æ±‡çŽ‡æ•°æ®ï¼‰"
    echo ""
    echo "### ðŸ“Š è‚¡ç¥¨ç›‘æŽ§"
    echo "- [ ] æ£€æŸ¥æ¯æ—¥è‚¡ç¥¨åˆ†æžæŽ¨é€"
    echo ""
}

# Create/update note
create_or_update_note() {
    local note_path="${NOTE_DIR}/n_66/content.txt"
    local content="# ${TODAY}

## ðŸŽ¯ ä»Šæ—¥é‡ç‚¹

### Morning Review
- [ ] å›žé¡¾æ˜¨æ—¥å¾…åŠžå®Œæˆæƒ…å†µ
- [ ] æŸ¥çœ‹è‚¡ç¥¨åˆ†æžæŽ¨é€
- [ ] ç¡®è®¤å½“æ—¥ä¼šè®®å®‰æŽ’

$(get_todos)

### ðŸ“… ä¼šè®®å®‰æŽ’
å¾…è¡¥å……...

### ðŸ’¡ ä»Šæ—¥çµæ„Ÿ/æƒ³æ³•
å¾…è¡¥å……...

---
*Generated by OpenClaw Auto-Note @ $(date '+%Y-%m-%d %H:%M')*"

    if [ -f "$note_path" ]; then
        # è¿½åŠ åˆ°å·²å­˜åœ¨çš„ç¬”è®°
        local existing_content=$(cat "$note_path")
        echo "$existing_content

--- Auto-Note Update ---
$content" > "$note_path"
        echo "âœ… Updated: n_66"
    else
        # åˆ›å»ºæ–°ç¬”è®°
        mkdir -p "${NOTE_DIR}/n_66"
        echo "$content" > "${NOTE_DIR}/n_66/content.txt"
        echo "$content" > "${NOTE_DIR}/n_66/snapshot.txt"
        echo "âœ… Created: n_66"
    fi
}

create_or_update_note
